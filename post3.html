<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mockup Chat â€” Preuve Client</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --bg1:#0f1020;
    --bg2:#1b1e3b;
    --glass:rgba(255,255,255,.08);
    --text:#e9ecf3;
    --muted:#b8bfd3;
    --accent:#8b5cf6;      /* bleu/violet pour bulle nous */
    --incoming:#2a2d53;    /* bulle client */
    --outline:rgba(255,255,255,.14);
    --green:#22c55e;
    --warn:#f59e0b;
    --err:#ef4444;
    --radius:18px;
    --shadow:0 14px 42px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 800px at 10% 10%, #1a1440 0%, transparent 60%),
      radial-gradient(900px 600px at 90% 20%, #031f3c 0%, transparent 55%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    display:grid; place-items:center;
    padding:24px;
  }

  /* Frame ponsel */
  .phone{
    position:relative;
    width:min(420px, 92vw);
    aspect-ratio:9/19.5;
    border-radius:36px;
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    box-shadow:var(--shadow);
    border:1px solid var(--outline);
    overflow:hidden;
  }
  .notch{
    position:absolute; inset:0 0 auto 0; height:34px;
    background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,0));
    z-index:2;
  }
  .status{
    position:absolute; top:6px; left:0; right:0;
    display:flex; justify-content:space-between; padding:0 14px; font-size:12px; opacity:.85;
  }

  /* Chat card (yang akan diexport) */
  .chat-card{
    position:absolute; inset:34px 0 0 0;
    display:grid; grid-template-rows:auto 1fr auto;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    backdrop-filter: blur(4px);
  }
  .topbar{
    display:flex; align-items:center; gap:10px; padding:10px 14px;
    border-bottom:1px solid var(--outline);
    background:rgba(0,0,20,.25);
  }
  .avatar{
    width:34px; height:34px; border-radius:50%;
    background:conic-gradient(from 45deg, #c4b5fd, #5eead4, #8b5cf6);
    filter:saturate(.8) brightness(.9);
    position:relative;
  }
  .name{
    font-weight:700; line-height:1.1;
    filter:blur(6px); /* default blur username */
  }
  .id{
    font-size:12px; color:var(--muted); margin-top:-2px;
    filter:blur(6px);
  }
  .meta{margin-left:auto; display:flex; gap:10px; align-items:center; color:var(--muted); font-size:12px}
  .shield{font-size:16px}

  .messages{
    padding:14px 12px 10px;
    overflow:auto;
    display:flex; flex-direction:column; gap:8px;
  }
  .date-divider{
    align-self:center; font-size:12px; color:var(--muted);
    background:rgba(255,255,255,.06); padding:4px 10px; border-radius:999px; border:1px solid var(--outline);
    margin:4px 0 8px;
  }
  .row{display:flex; gap:8px; align-items:flex-end; max-width:100%}
  .row.in{justify-content:flex-start}
  .row.out{justify-content:flex-end}

  .bubble{
    max-width:75%;
    padding:10px 12px;
    border-radius:16px;
    border:1px solid var(--outline);
    box-shadow:0 4px 18px rgba(0,0,0,.24);
    word-wrap:break-word; white-space:pre-wrap;
    font-size:15px;
  }
  .in .bubble{
    background:var(--incoming);
    border-top-left-radius:6px;
  }
  .out .bubble{
    background:linear-gradient(135deg, var(--accent), #5eead4);
    color:#0a0a12;
    border-top-right-radius:6px;
  }
  .time{
    font-size:11px; color:var(--muted); padding:0 4px 4px;
  }
  .ticks{
    font-size:12px; color:#0a0a12; opacity:.75; margin-left:6px; user-select:none;
  }

  .composer{
    display:flex; align-items:center; gap:8px; padding:10px; border-top:1px solid var(--outline);
    background:rgba(0,0,20,.28);
  }
  .input{
    flex:1; display:flex; align-items:center; gap:8px;
    background:rgba(255,255,255,.06); border:1px solid var(--outline);
    padding:10px 12px; border-radius:999px; color:var(--text);
  }
  .input span{opacity:.7; font-size:14px}
  .send{
    border:none; border-radius:999px; padding:10px 14px; cursor:pointer;
    background:linear-gradient(90deg, var(--accent), #06b6d4); color:#0a0a12; font-weight:700;
  }

  /* Toolbar export + toggle blur */
  .toolbar{
    margin-top:14px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center;
  }
  .btn{
    padding:10px 14px; border-radius:12px; background:rgba(255,255,255,.08);
    border:1px solid var(--outline); color:var(--text); cursor:pointer; font-weight:700;
  }
  .btn.primary{background:linear-gradient(90deg, var(--accent), #06b6d4); color:#0a0a12; border-color:transparent}
  .small{font-size:12px; color:var(--muted); text-align:center; margin-top:6px}

  /* Scrollbar halus */
  .messages::-webkit-scrollbar{height:8px;width:8px}
  .messages::-webkit-scrollbar-thumb{background:rgba(255,255,255,.14); border-radius:999px}
  /* Reduced motion */
  @media (prefers-reduced-motion: reduce){
    *{animation:none !important; transition:none !important}
  }
</style>
</head>
<body>
  <!-- Frame ponsel -->
  <div id="capture-wrap">
    <div class="phone" id="phone">
      <div class="notch"></div>
      <div class="status">
        <div>FR â€¢ LTE</div>
        <div id="clock">18.20</div>
      </div>

      <!-- AREA yang diexport -->
      <section class="chat-card" id="chat-card">
        <header class="topbar">
          <div class="avatar" aria-hidden="true"></div>
          <div>
            <div class="name" id="username">client_94821</div>
            <div class="id" id="userid">@id-xx-4833</div>
          </div>
          <div class="meta">
            <span class="shield">ðŸ”’</span>
            <span>En ligne</span>
          </div>
        </header>

        <div class="messages" id="messages" role="log" aria-live="polite">
          <div class="date-divider">Aujourdâ€™hui â€¢ <span id="dateStr">18.10</span></div>

          <!-- Pesan masuk (klien) -->
          <div class="row in">
            <div class="bubble">
              Un boulot pareil et tu mets des plombes?
            </div>
          </div>
          <div class="row in">
            <div class="time">18.10</div>
          </div>

          <!-- Balasan kita (opsional untuk konteks visual) -->
          <div class="row out">
            <div class="bubble">
              Bonjour, je comprends votre frustration. Je vous envoie lâ€™update tout de suite.
              <span class="ticks">âœ”âœ”</span>
            </div>
          </div>
          <div class="row out">
            <div class="time">18.18</div>
          </div>
        </div>

        <div class="composer" aria-label="Zone de saisie">
          <div class="input"><span>Messageâ€¦</span></div>
          <button class="send" type="button">Envoyer</button>
        </div>
      </section>
      <!-- /AREA export -->
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <button class="btn" id="toggleBlur">Afficher/Masquer blur ID</button>
    <label class="btn" style="display:flex; align-items:center; gap:8px">
      Ã‰chelle export&nbsp;
      <select id="scaleSel" style="background:transparent; color:inherit; border:none; outline:none">
        <option value="2">2Ã— (HD)</option>
        <option value="3" selected>3Ã— (TrÃ¨s net)</option>
        <option value="4">4Ã— (Ultra)</option>
      </select>
    </label>
    <button class="btn primary" id="downloadBtn">TÃ©lÃ©charger en HD (PNG)</button>
  </div>
  <div class="small">Lâ€™ID/nom est floutÃ© par dÃ©faut pour protÃ©ger lâ€™identitÃ© du client.</div>

<script>
  // Jam / tanggal FR
  function pad(n){return n.toString().padStart(2,'0')}
  function setClock(){
    const now=new Date();
    const hh=pad(now.getHours()), mm=pad(now.getMinutes());
    document.getElementById('clock').textContent=`${hh}:${mm}`;
    document.getElementById('dateStr').textContent=`${hh}:${mm}`;
  }
  setClock(); setInterval(setClock, 30*1000);

  // Toggle blur
  const toggleBtn=document.getElementById('toggleBlur');
  toggleBtn.addEventListener('click',()=>{
    ['username','userid'].forEach(id=>{
      const el=document.getElementById(id);
      const cur=getComputedStyle(el).filter;
      el.style.filter = (cur && !cur.includes('none')) ? 'none' : 'blur(6px)';
    });
  });

  // ===== Export HD tanpa library eksternal =====
  // Teknik: bungkus #chat-card dalam SVG <foreignObject> + <style> (CSS disuntikkan),
  // render ke <canvas> skala 2â€“4Ã—, lalu download PNG.
  function collectStyles(){
    // Kumpulkan isi semua <style> di dokumen agar foreignObject punya styling yang sama
    let cssText='';
    for(const sheet of document.styleSheets){
      try{
        for(const rule of sheet.cssRules){ cssText += rule.cssText + '\n'; }
      }catch(e){
        // StyleSheet yang cross-origin akan melempar; tapi disini semua inline => aman.
      }
    }
    return cssText;
  }

  async function exportNodeToPNG(node, scale=3, fileName='chat.png'){
    const rect = node.getBoundingClientRect();
    const width = Math.ceil(rect.width);
    const height = Math.ceil(rect.height);

    // Konstruksi SVG dengan foreignObject
    const css = collectStyles();
    const xhtml = new XMLSerializer().serializeToString(node);

    const svg =
`<svg xmlns="http://www.w3.org/2000/svg" width="${width*scale}" height="${height*scale}">
  <foreignObject x="0" y="0" width="${width*scale}" height="${height*scale}">
    <div xmlns="http://www.w3.org/1999/xhtml" style="transform-origin:0 0; transform: scale(${scale});">
      <style>${css}</style>
      ${xhtml}
    </div>
  </foreignObject>
</svg>`;

    const svgBlob = new Blob([svg], {type:'image/svg+xml;charset=utf-8'});
    const url = URL.createObjectURL(svgBlob);

    // Gambar ke canvas
    const img = new Image();
    img.decoding = 'async';
    img.onload = ()=>{
      const canvas = document.createElement('canvas');
      canvas.width = width*scale;
      canvas.height = height*scale;
      const ctx = canvas.getContext('2d');
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(img, 0, 0);
      URL.revokeObjectURL(url);
      // Unduh PNG
      canvas.toBlob((blob)=>{
        const a=document.createElement('a');
        a.download=fileName;
        a.href=URL.createObjectURL(blob);
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
      }, 'image/png', 1.0);
    };
    img.onerror = ()=>{
      alert("Export Ã©chouÃ©. RÃ©essayez.");
      URL.revokeObjectURL(url);
    }
    img.src = url;
  }

  document.getElementById('downloadBtn').addEventListener('click', ()=>{
    const scale = parseInt(document.getElementById('scaleSel').value,10) || 3;
    const node = document.getElementById('chat-card');
    exportNodeToPNG(node, scale, `preuv_client_${scale}x.png`);
  });

  // Aksesibilitas: enter pada tombol
  document.addEventListener('keydown', (e)=>{
    if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='s'){
      e.preventDefault();
      document.getElementById('downloadBtn').click();
    }
  });
</script>
</body>
</html>
